<%= link_to "← Back to Vehicle", @vehicle, role: "button", class: "secondary outline" %>

<article>
  <header>
    <h1>Search Images for <%= @vehicle.year %> <%= @vehicle.manufacturer.name %> <%= @vehicle.name %></h1>
    <p>Select images to download and attach to this vehicle</p>
  </header>

  <%= form_with url: attach_selected_images_vehicle_path(@vehicle), method: :post do |f| %>
    <% if @image_results.any? %>
      <div class="grid">
        <% @image_results.each_with_index do |image_url, index| %>
          <label>
            <input type="checkbox" name="selected_image_urls[]" value="<%= image_url %>" />
            <figure>
              <img src="<%= image_url %>" alt="Search result <%= index + 1 %>" loading="lazy" style="width: 100%; height: auto; border-radius: var(--border-radius);" />
            </figure>
          </label>
        <% end %>
      </div>

      <div style="margin-top: 2rem;">
        <%= f.submit "Download & Attach Selected Images" %>
        <%= link_to "Cancel", @vehicle, role: "button", class: "secondary" %>
      </div>
    <% else %>
      <p><em>No images found. Try searching manually or uploading your own images.</em></p>
      <%= link_to "Back to Vehicle", @vehicle, role: "button" %>
    <% end %>
  <% end %>
</article>

<style>
  /* Custom styling for image selection */
  label:has(input[type="checkbox"]) {
    cursor: pointer;
    display: block;
  }

  label:has(input[type="checkbox"]) figure {
    border: 2px solid transparent;
    transition: all 0.2s ease;
    margin: 0;
  }

  label:has(input[type="checkbox"]:checked) figure {
    border-color: var(--primary);
    box-shadow: 0 0 0 4px var(--primary-focus);
  }

  label:has(input[type="checkbox"]) input[type="checkbox"] {
    position: absolute;
    opacity: 0;
  }

  label:has(input[type="checkbox"]:checked)::after {
    content: "✓ Selected";
    display: block;
    text-align: center;
    color: var(--primary);
    font-weight: bold;
    margin-top: 0.5rem;
  }
</style>
